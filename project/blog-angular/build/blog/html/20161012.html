<h1 id="-javascript-">探秘JavaScript中的六个字符</h1>
<blockquote>
<ul>
<li><strong>文章来源：译文</strong></li>
<li><strong>发布时间：2016-10-12</strong></li>
<li><strong>关键词：Javascript</strong></li>
<li><strong>转载需标注本文原始地址: <a href="http://zhaomenghuan.github.io/#!/blog/20161012">http://zhaomenghuan.github.io/#!/blog/20161012</a></strong></li>
</ul>
</blockquote>
<p>本文为译文，原文地址：</p>
<blockquote>
<p><a href="http://jazcash.com/a-javascript-journey-with-only-six-characters/">http://jazcash.com/a-javascript-journey-with-only-six-characters/</a></p>
</blockquote>
<p>JavaScript 是一个奇怪而有趣的语言，我们可以写一些疯狂却仍然有效的代码。它试图帮助我们把事情转换到基于我们如何对待他们的特定类型。</p>
<p>如果我们添加一个字符串,JavaScript会假定我们希望为文本形式表示,所以将它转换为一个字符串。如果我们添加一个正负前缀符号,JavaScript会假定我们希望为数值形式表示,如果可能的话,对我们来说并将字符串转换为一个数字。如果我们添加一个否定符号，JavaScript会将将字符串转换为一个布尔值。</p>
<p>我们可以使用Javascript中<code>[</code>,<code>]</code>,<code>(</code>,<code>)</code>,<code>!</code> and <code>+</code>这六个符号写一些神奇的代码。如果你现在不是在手机，你可以打开浏览器的控制台，你可以将任何代码示例粘贴到控制台，并且代码值为true。</p>
<p>让我们从最基本的开始，要记住一些黄金规则:</p>
<p><code>!</code>后面跟的字符会被转换成布尔值</p>
<p><code>+</code>后面跟的字符会被转换成数值</p>
<p><code>[]</code>后面跟的字符会被转换成字符串</p>
<p>来看下面的例子：</p>
<pre><code class="lang-js">![] === false
+[] === 0
[]+[] === &quot;&quot;
</code></pre>
<p>另一件事你应该知道的是,它可以从字符串使用方括号检索特定的字母，像这样：</p>
<pre><code class="lang-js">&quot;hello&quot;[0] === &quot;h&quot;
</code></pre>
<p>还记得可以使多个数字号码通过添加字符串表示在一起,然后把整个表达式转换成一个数字：</p>
<pre><code class="lang-js">+(&quot;1&quot; + &quot;1&quot;) === 11
</code></pre>
<p>我们们继续把一些东西结合在一起得到字母<code>a</code></p>
<pre><code class="lang-js">![] === false
![]+[] === &quot;false&quot;
+!![] === 1
------------------------
(![]+[])[+!![]] === &quot;a&quot;  // same as &quot;false&quot;[1]
</code></pre>
<p>举一反三！</p>
<p>我们可以通过<code>true</code> 和 <code>false</code>得到相似的字母<code>a</code>,<code>e</code>,<code>f</code>,<code>l</code>,<code>r</code>,<code>s</code>,<code>t</code>,<code>u</code>，那么我们可以从其他地方得到的字母吗？</p>
<p>我们可以通过一些特别的式子如<code>[][[]]</code>得到<code>undefined</code>，利用我们上面讲到的黄金法则得到另外的字母<code>d</code>,<code>i</code> 和 <code>n</code>。</p>
<pre><code class="lang-js">`[][[]] + [] === &quot;undefined&quot;`
</code></pre>
<p>到目前为止，利用我们已经获得的所有字母,我们可以拼<code>fill</code>, <code>filter</code> 和 <code>find</code>。当然也有一些其他的单词，我们也可以拼写，但这些单词最重要的是,他们都是<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array#Mutator_methods">数组的方法</a>。这意味着他们是数组对象的一部分,可以直接调用数组实例，如：<code>[2,1].sort()</code>。</p>
<p>现在，了解JavaScript的另一件重要的特性是一个对象的属性可以通过<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Operators/Property_accessors">点符号<code>.</code>或方括号<code>[]</code></a>访问。上述数组方法是数组对象本身的属性，我们可以使用方括号代替点符号调用这些方法。</p>
<p>所以<code>[2,1][&quot;sort&quot;]()</code> 等效于 <code>[2,1].sort()</code>.</p>
<p>我们继续看看,当我们试图使用一个数组的方法会发生什么,我们可以使用到目前为止我们拼写的但没有调用的字母。</p>
<pre><code class="lang-js">[][&quot;fill&quot;]
</code></pre>
<p>这会得到<code>function fill() { [native code] }</code>，我们可以把这个方法头作为一个字符串再次使用我们的黄金法则：</p>
<pre><code class="lang-js">[][&quot;fill&quot;]+[] === &quot;function fill() { [native code] }&quot;
</code></pre>
<p>所以现在我们又得到其他的字符：<code>c</code>,<code>o</code>,<code>v</code>,<code>(</code>,<code>)</code>,<code>{</code>,<code>[</code>,<code>]</code>,<code>}</code>。</p>
<p>随着我们新得到的<code>c</code>和<code>o</code>，我们现在可以形成<code>constructor</code>这个单词。构造函数是一个方法,所有JS对象仅返回自己的构造函数。</p>
<p>到目前为止我们已经处理的对象，我们可以得到它用字符串表示的构造器函数：</p>
<pre><code class="lang-js">true[&quot;constructor&quot;] + [] === &quot;function Boolean() { [native code] }&quot;  
0[&quot;constructor&quot;] + []    === &quot;function Number() { [native code] }&quot;  
&quot;&quot;[&quot;constructor&quot;] + []   === &quot;function String() { [native code] }&quot;
[][&quot;constructor&quot;] + []   === &quot;function Array() { [native code] }&quot;
({})[&quot;constructor&quot;] + [] === &quot;function Object() { [native code] }&quot;
</code></pre>
<p>通过这些式子，我们可以将下面的字符加入到我们的库中：
<code>B</code>,<code>N</code>,<code>S</code>,<code>A</code>,<code>O</code>,<code>m</code>,<code>b</code>,<code>g</code>,<code>y</code>,<code>j</code>。</p>
<p>现在我们可以构造一个我们可以使用方括号的函数&quot;toString&quot;`,我们可以这样调用：</p>
<pre><code class="lang-js">(10)[&quot;toString&quot;]() === &quot;10&quot;
</code></pre>
<p>使用我们的黄金法则，我们已经可以将任何我们想要转换成一个字符串，但是上面这个式子怎么用呢？</p>
<p>好吧，我告诉你，<code>Number</code>类型的<code>toString</code>方法有一个称为<code>radix</code>(“基数”)的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toString">秘密的论点</a>。它可以将数值在转换为一个字符串之前先经过基数换算，像这样：</p>
<pre><code class="lang-js">(12)[&quot;toString&quot;](10) === &quot;12&quot;  // 十进制
(12)[&quot;toString&quot;](2) === &quot;1100&quot; // 二进制
(12)[&quot;toString&quot;](8) === &quot;14&quot;   // 八进制
(12)[&quot;toString&quot;](16) === &quot;c&quot;   // 十六进制
</code></pre>
<p>但是为什么基数只写到16？最大值是36，包括所有的字符<code>0</code>-<code>9</code> 和 <code>a</code>-<code>z</code>，所以现在我们可以得到任何我们想要的字母数字：</p>
<pre><code class="lang-js">(10)[&quot;toString&quot;](36) === &quot;a&quot;
(35)[&quot;toString&quot;](36) === &quot;z&quot;
</code></pre>
<p>太棒了!但是其它符号如标点符号和大写字母呢？我们接着深入探索。</p>
<p>这取决于你的JS执行时，它可能会或可能不会访问特定的预定义的对象或数据。如果你在浏览器中运行它,那么你可以访问一些存在的<a href="https://developer.mozilla.org/en-US/docs/tag/HTML%20wrapper%20methods">HTML包装器方法</a>。</p>
<p>例如，<code>bold</code>是一个包装在<code>&lt;&gt;</code>标签中的字符串方法。</p>
<pre><code class="lang-js">&quot;test&quot;[&quot;bold&quot;]() === &quot;&lt;b&gt;test&lt;/b&gt;&quot;
</code></pre>
<p>通过这个我们得到<code>&lt;&gt;</code>和<code>/</code>两个字符。</p>
<p>你可能听说过<code>escape</code>方法，它主要将字符串转换为一个URI友好的格式，可以让简单的浏览器解释。如果我们传递一个空格字符，我们得到的&quot;%20&quot;。</p>
<p>这里有一个工具可以自动将每个字符自动转换。
工具地址：<a href="http://www.jsfuck.com/">http://www.jsfuck.com/</a>
源代码地址：<a href="https://raw.githubusercontent.com/aemkei/jsfuck/master/jsfuck.js">https://raw.githubusercontent.com/aemkei/jsfuck/master/jsfuck.js</a></p>
<h2 id="-">为什么这几个字符有用？</h2>
<p>它不是易趣网做的一些不好的事情,不久前允许卖家将执行JS在页面中使用只能使用这些字符，但它是一个相当罕见的攻击向量。有些人说混淆，但事实上，有更好的方法混淆。</p>
<p>最后，希望你会喜欢本次探秘之旅。</p>
<h2 id="-">参考资料</h2>
<blockquote>
<ul>
<li><a href="https://en.wikipedia.org/wiki/JSFuck">https://en.wikipedia.org/wiki/JSFuck</a></li>
<li><a href="https://esolangs.org/wiki/JSFuck">https://esolangs.org/wiki/JSFuck</a></li>
<li><a href="http://patriciopalladino.com/blog/2012/08/09/non-alphanumeric-javascript.html">http://patriciopalladino.com/blog/2012/08/09/non-alphanumeric-javascript.html</a></li>
<li><a href="https://raw.githubusercontent.com/aemkei/jsfuck/master/jsfuck.js">https://raw.githubusercontent.com/aemkei/jsfuck/master/jsfuck.js</a></li>
</ul>
</blockquote>
